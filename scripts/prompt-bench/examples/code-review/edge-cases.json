[
  {
    "id": "large-test-file-approve",
    "description": "Tests for authenticate, validateToken, refreshToken \u2014 should approve",
    "issueTitle": "Add auth module test suite",
    "issueNumber": 201,
    "acceptanceCriteria": "- Tests for authenticate: valid credentials, invalid password, unknown email\n- Tests for validateToken: valid, expired, malformed tokens\n- Tests for refreshToken: valid, expired\n- Token fixtures imported from test helpers",
    "diffStats": {
      "filesChanged": 3,
      "linesChanged": 300
    },
    "branch": "test/201-auth-tests",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/tests/auth/login.test.ts\n+++ b/tests/auth/login.test.ts\n@@ -0,0 +1,40 @@\n+import { describe, it, expect } from \"vitest\";\n+import { authenticate, validateToken, refreshToken } from \"../../src/auth\";\n+import { createValidToken, createExpiredToken, createValidRefreshToken, createExpiredRefreshToken } from \"../fixtures/tokens\";\n+\n+describe(\"authenticate\", () => {\n+  it(\"returns token for valid credentials\", async () => {\n+    const result = await authenticate(\"user@test.com\", \"validPass123!\");\n+    expect(result.token).toBeDefined();\n+    expect(result.expiresIn).toBe(3600);\n+  });\n+  it(\"rejects invalid password\", async () => {\n+    await expect(authenticate(\"user@test.com\", \"wrong\")).rejects.toThrow();\n+  });\n+  it(\"rejects unknown email\", async () => {\n+    await expect(authenticate(\"nobody@test.com\", \"pass\")).rejects.toThrow();\n+  });\n+});\n+\n+describe(\"validateToken\", () => {\n+  it(\"validates unexpired token\", () => {\n+    expect(validateToken(createValidToken())).toBe(true);\n+  });\n+  it(\"rejects expired token\", () => {\n+    expect(validateToken(createExpiredToken())).toBe(false);\n+  });\n+  it(\"rejects malformed token\", () => {\n+    expect(validateToken(\"not-a-token\")).toBe(false);\n+  });\n+});\n+\n+describe(\"refreshToken\", () => {\n+  it(\"returns new token for valid refresh token\", async () => {\n+    const result = await refreshToken(createValidRefreshToken());\n+    expect(result.token).toBeDefined();\n+  });\n+  it(\"rejects expired refresh token\", async () => {\n+    await expect(refreshToken(createExpiredRefreshToken())).rejects.toThrow();\n+  });\n+});"
  },
  {
    "id": "lock-file-only-approve",
    "description": "package-lock.json updated for express 4.19.2 \u2014 should approve",
    "issueTitle": "Update express version in lock file",
    "issueNumber": 202,
    "acceptanceCriteria": "- Express version bumped from 4.18.2 to 4.19.2\n- Lock file integrity hashes updated",
    "diffStats": {
      "filesChanged": 1,
      "linesChanged": 500
    },
    "branch": "chore/202-lockfile",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/package-lock.json\n+++ b/package-lock.json\n@@ -100,7 +100,7 @@\n       \"node_modules/express\": {\n-        \"version\": \"4.18.2\",\n-        \"resolved\": \"https://registry.npmjs.org/express/-/express-4.18.2.tgz\",\n-        \"integrity\": \"sha512-abc123...\",\n+        \"version\": \"4.19.2\",\n+        \"resolved\": \"https://registry.npmjs.org/express/-/express-4.19.2.tgz\",\n+        \"integrity\": \"sha512-def456...\",\n       }"
  },
  {
    "id": "migration-file-approve",
    "description": "SQL migration with up/down for preferences \u2014 should approve",
    "issueTitle": "Add user_preferences table migration",
    "issueNumber": 203,
    "acceptanceCriteria": "- Creates user_preferences table with user_id (unique), theme, language, notifications\n- user_id has UNIQUE constraint and ON DELETE CASCADE\n- Uses IF NOT EXISTS/IF EXISTS for idempotency\n- Rollback drops table",
    "diffStats": {
      "filesChanged": 1,
      "linesChanged": 30
    },
    "branch": "feat/203-preferences-migration",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/migrations/20240315_add_preferences.sql\n+++ b/migrations/20240315_add_preferences.sql\n@@ -0,0 +1,13 @@\n+-- Up\n+CREATE TABLE IF NOT EXISTS user_preferences (\n+  id INTEGER PRIMARY KEY AUTOINCREMENT,\n+  user_id INTEGER NOT NULL UNIQUE REFERENCES users(id) ON DELETE CASCADE,\n+  theme VARCHAR(20) DEFAULT 'light',\n+  language VARCHAR(10) DEFAULT 'en',\n+  notifications BOOLEAN DEFAULT true,\n+  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n+);\n+\n+-- Down\n+DROP TABLE IF EXISTS user_preferences;"
  },
  {
    "id": "i18n-strings-approve",
    "description": "German i18n JSON with common, auth, dashboard, error keys \u2014 should approve",
    "issueTitle": "Add German translation strings",
    "issueNumber": 204,
    "acceptanceCriteria": "- German translations for common actions (save, cancel, delete, edit)\n- Auth translations (login, logout, register)\n- Dashboard and error translations",
    "diffStats": {
      "filesChanged": 2,
      "linesChanged": 150
    },
    "branch": "feat/204-german-i18n",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/i18n/de.json\n+++ b/src/i18n/de.json\n@@ -0,0 +1,15 @@\n+{\n+  \"common.save\": \"Speichern\",\n+  \"common.cancel\": \"Abbrechen\",\n+  \"common.delete\": \"L\u00f6schen\",\n+  \"common.edit\": \"Bearbeiten\",\n+  \"auth.login\": \"Anmelden\",\n+  \"auth.logout\": \"Abmelden\",\n+  \"auth.register\": \"Registrieren\",\n+  \"dashboard.title\": \"\u00dcbersicht\",\n+  \"dashboard.welcome\": \"Willkommen, {{name}}\",\n+  \"errors.notFound\": \"Seite nicht gefunden\",\n+  \"errors.serverError\": \"Ein Fehler ist aufgetreten\",\n+  \"errors.unauthorized\": \"Nicht autorisiert\"\n+}"
  },
  {
    "id": "snapshot-update-approve",
    "description": "Snapshot reflects new header with logo and nav \u2014 should approve",
    "issueTitle": "Update header snapshot after redesign",
    "issueNumber": 205,
    "acceptanceCriteria": "- Snapshot updated from plain div to semantic header element\n- Logo image added\n- Navigation links use nav-link class",
    "diffStats": {
      "filesChanged": 5,
      "linesChanged": 200
    },
    "branch": "test/205-snapshot-update",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/tests/__snapshots__/Header.test.tsx.snap\n+++ b/tests/__snapshots__/Header.test.tsx.snap\n@@ -2,10 +2,12 @@\n exports[`Header renders correctly 1`] = `\n-<div class=\"header\">\n-  <h1>My App</h1>\n-  <nav>\n-    <a href=\"/\">Home</a>\n-  </nav>\n-</div>\n+<header class=\"header header--redesigned\">\n+  <div class=\"header__logo\">\n+    <img src=\"/logo.svg\" alt=\"My App\" />\n+  </div>\n+  <nav class=\"header__nav\">\n+    <a href=\"/\" class=\"nav-link\">Home</a>\n+    <a href=\"/about\" class=\"nav-link\">About</a>\n+  </nav>\n+</header>\n `;"
  },
  {
    "id": "env-example-approve",
    "description": "Environment variable template with placeholders \u2014 should approve",
    "issueTitle": "Add .env.example file",
    "issueNumber": 206,
    "acceptanceCriteria": "- DATABASE_URL, JWT_SECRET, PORT, LOG_LEVEL documented\n- Placeholder values only, no real secrets\n- Grouped by category with comments",
    "diffStats": {
      "filesChanged": 2,
      "linesChanged": 15
    },
    "branch": "docs/206-env-example",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/.env.example\n+++ b/.env.example\n@@ -0,0 +1,8 @@\n+# Database\n+DATABASE_URL=postgres://localhost:5432/myapp\n+\n+# Auth\n+JWT_SECRET=change-me-in-production\n+\n+# API\n+PORT=3000\n+LOG_LEVEL=info"
  },
  {
    "id": "multi-file-rename-approve",
    "description": "Move format.ts from utils to lib, update imports \u2014 should approve",
    "issueTitle": "Rename utils/ to lib/",
    "issueNumber": 207,
    "acceptanceCriteria": "- format.ts moved from src/utils/ to src/lib/\n- Import paths updated in dependent files\n- No behavior change",
    "diffStats": {
      "filesChanged": 12,
      "linesChanged": 40
    },
    "branch": "refactor/207-rename-utils",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/utils/format.ts\n+++ b/src/lib/format.ts\n@@ -1,5 +1,5 @@\n export function formatDate(d: Date): string {\n   return d.toISOString().split(\"T\")[0];\n }\n--- a/src/services/order.ts\n+++ b/src/services/order.ts\n@@ -1,4 +1,4 @@\n-import { formatDate } from \"../utils/format\";\n+import { formatDate } from \"../lib/format\";"
  },
  {
    "id": "perf-optimization-approve",
    "description": "VirtualList renders only visible items \u2014 should approve",
    "issueTitle": "Add virtual scrolling list component",
    "issueNumber": 208,
    "acceptanceCriteria": "- Renders only visible items based on scroll position\n- Uses useMemo for performance\n- VirtualListProps interface with generics\n- All React hooks properly imported\n- Stable keys based on offset position",
    "diffStats": {
      "filesChanged": 3,
      "linesChanged": 80
    },
    "branch": "perf/208-virtual-scroll",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/components/VirtualList.tsx\n+++ b/src/components/VirtualList.tsx\n@@ -0,0 +1,30 @@\n+import { useMemo, useRef, useState } from \"react\";\n+\n+interface VirtualListProps<T> {\n+  items: T[];\n+  itemHeight: number;\n+  renderItem: (item: T) => React.ReactNode;\n+  containerHeight?: number;\n+}\n+\n+export function VirtualList<T>({ items, itemHeight, renderItem, containerHeight = 400 }: VirtualListProps<T>) {\n+  const containerRef = useRef<HTMLDivElement>(null);\n+  const [scrollTop, setScrollTop] = useState(0);\n+\n+  const visibleItems = useMemo(() => {\n+    const startIndex = Math.floor(scrollTop / itemHeight);\n+    const endIndex = Math.min(startIndex + Math.ceil(containerHeight / itemHeight) + 1, items.length);\n+    return items.slice(startIndex, endIndex).map((item, i) => ({\n+      item,\n+      offset: (startIndex + i) * itemHeight,\n+    }));\n+  }, [items, scrollTop, itemHeight, containerHeight]);\n+\n+  return (\n+    <div ref={containerRef} style={{ height: containerHeight, overflow: \"auto\", position: \"relative\" }}\n+      onScroll={(e) => setScrollTop(e.currentTarget.scrollTop)}>\n+      <div style={{ height: items.length * itemHeight }}>\n+        {visibleItems.map(({ item, offset }) => (\n+          <div key={offset} style={{ position: \"absolute\", top: offset, height: itemHeight }}>{renderItem(item)}</div>\n+        ))}\n+      </div>\n+    </div>\n+  );\n+}"
  },
  {
    "id": "ci-config-approve",
    "description": "CI with install, lint, test, build steps \u2014 should approve",
    "issueTitle": "Add GitHub Actions CI workflow",
    "issueNumber": 209,
    "acceptanceCriteria": "- Runs on push and pull_request\n- Uses Node.js 20 with npm cache\n- Steps: npm ci, lint, test, build",
    "diffStats": {
      "filesChanged": 1,
      "linesChanged": 40
    },
    "branch": "chore/209-ci-workflow",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/.github/workflows/ci.yml\n+++ b/.github/workflows/ci.yml\n@@ -0,0 +1,25 @@\n+name: CI\n+on: [push, pull_request]\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: actions/checkout@v4\n+      - uses: actions/setup-node@v4\n+        with:\n+          node-version: 20\n+          cache: npm\n+      - run: npm ci\n+      - run: npm run lint\n+      - run: npm run test\n+      - run: npm run build"
  },
  {
    "id": "feature-flag-approve",
    "description": "Env-driven feature flag with checkout fallback \u2014 should approve",
    "issueTitle": "Add feature flag for new checkout flow",
    "issueNumber": 210,
    "acceptanceCriteria": "- Feature flags with runtime env override via FEATURE_<NAME> pattern\n- newCheckout flag defaults to false\n- isFeatureEnabled function checks env then defaults\n- NewCheckoutFlow properly imported\n- Falls back to legacy flow when disabled",
    "diffStats": {
      "filesChanged": 3,
      "linesChanged": 35
    },
    "branch": "feat/210-feature-flag",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/features/flags.ts\n+++ b/src/features/flags.ts\n@@ -3,6 +3,11 @@\n-export const featureFlags = {\n+export const featureFlags = Object.freeze({\n   darkMode: true,\n   betaSearch: false,\n-} as const;\n+  newCheckout: false,\n+});\n+\n+export function isFeatureEnabled(flag: keyof typeof featureFlags): boolean {\n+  const envKey = `FEATURE_${flag.toUpperCase()}`;\n+  const envVal = process.env[envKey];\n+  if (envVal !== undefined) return envVal === \"true\";\n+  return featureFlags[flag];\n+}\n--- a/src/checkout/index.ts\n+++ b/src/checkout/index.ts\n@@ -1,5 +1,9 @@\n+import { isFeatureEnabled } from \"../features/flags\";\n+import { NewCheckoutFlow } from \"./new-checkout\";\n import { LegacyCheckoutFlow } from \"./legacy-checkout\";\n \n export function getCheckoutFlow() {\n+  if (isFeatureEnabled(\"newCheckout\")) {\n+    return new NewCheckoutFlow();\n+  }\n   return new LegacyCheckoutFlow();\n }"
  },
  {
    "id": "deprecation-warning-approve",
    "description": "Sunset and Deprecation headers on v1 endpoint \u2014 should approve",
    "issueTitle": "Add deprecation headers to legacy endpoint",
    "issueNumber": 211,
    "acceptanceCriteria": "- Deprecated endpoint logs warning with endpoint context\n- Sunset header with future date (March 2027)\n- Deprecation: true header set\n- Link header points to successor version",
    "diffStats": {
      "filesChanged": 3,
      "linesChanged": 25
    },
    "branch": "chore/211-deprecation",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/api/legacy.ts\n+++ b/src/api/legacy.ts\n@@ -3,6 +3,13 @@\n+const SUNSET_DATE = \"Sat, 01 Mar 2027 00:00:00 GMT\";\n+\n router.get(\"/api/v1/items\", (req, res, next) => {\n+  logger.warn({ endpoint: \"/api/v1/items\" }, \"deprecated endpoint accessed\");\n+  res.set(\"Sunset\", SUNSET_DATE);\n+  res.set(\"Deprecation\", \"true\");\n+  res.set(\"Link\", '</api/v2/items>; rel=\"successor-version\"');\n   next();\n });"
  },
  {
    "id": "webhook-handler-approve",
    "description": "Stripe webhook with constructEvent validation \u2014 should approve",
    "issueTitle": "Add Stripe webhook handler with signature verification",
    "issueNumber": 212,
    "acceptanceCriteria": "- Stripe env vars validated at startup (throws if missing)\n- Signature verified via constructEvent\n- Invalid signatures return 400 with warning log\n- processPayment properly imported\n- Error handling around event processing\n- Returns { received: true } on success",
    "diffStats": {
      "filesChanged": 2,
      "linesChanged": 55
    },
    "branch": "feat/212-stripe-webhook",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/api/webhooks/stripe.ts\n+++ b/src/api/webhooks/stripe.ts\n@@ -0,0 +1,30 @@\n+import { Router } from \"express\";\n+import Stripe from \"stripe\";\n+import { processPayment } from \"../services/payment\";\n+import { logger } from \"../logger\";\n+\n+const stripeKey = process.env.STRIPE_SECRET_KEY;\n+const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\n+if (!stripeKey || !webhookSecret) throw new Error(\"STRIPE_SECRET_KEY and STRIPE_WEBHOOK_SECRET required\");\n+\n+const stripe = new Stripe(stripeKey);\n+const router = Router();\n+\n+// Must use raw body for signature verification\n+router.post(\"/webhooks/stripe\", async (req, res) => {\n+  const sig = req.headers[\"stripe-signature\"] as string;\n+  let event: Stripe.Event;\n+  try {\n+    event = stripe.webhooks.constructEvent(req.body, sig, webhookSecret);\n+  } catch (err) {\n+    logger.warn({ err }, \"invalid stripe signature\");\n+    return res.status(400).json({ error: \"Invalid signature\" });\n+  }\n+\n+  try {\n+    if (event.type === \"payment_intent.succeeded\") {\n+      const payment = event.data.object as Stripe.PaymentIntent;\n+      await processPayment(payment.id, payment.amount);\n+    }\n+    res.json({ received: true });\n+  } catch (err) {\n+    logger.error({ err, eventType: event.type }, \"webhook processing failed\");\n+    res.status(500).json({ error: \"Processing failed\" });\n+  }\n+});\n+\n+export default router;"
  },
  {
    "id": "graceful-shutdown-approve",
    "description": "Signal handlers for clean server shutdown \u2014 should approve",
    "issueTitle": "Add graceful shutdown on SIGTERM/SIGINT",
    "issueNumber": 213,
    "acceptanceCriteria": "- SIGTERM and SIGINT handlers registered\n- Guard against duplicate shutdown calls\n- Server closes accepting new connections\n- Database pool drained with error handling\n- Force exit after 10s timeout",
    "diffStats": {
      "filesChanged": 2,
      "linesChanged": 30
    },
    "branch": "feat/213-graceful-shutdown",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/server.ts\n+++ b/src/server.ts\n@@ -10,6 +10,22 @@\n const server = app.listen(config.port, () => {\n   logger.info({ port: config.port }, \"server started\");\n });\n+\n+let shuttingDown = false;\n+\n+function gracefulShutdown(signal: string) {\n+  if (shuttingDown) return;\n+  shuttingDown = true;\n+  logger.info({ signal }, \"shutdown signal received\");\n+  server.close(() => {\n+    logger.info(\"all connections closed\");\n+    db.end()\n+      .then(() => { logger.info(\"database pool closed\"); process.exit(0); })\n+      .catch((err) => { logger.error({ err }, \"error closing database\"); process.exit(1); });\n+  });\n+  setTimeout(() => { logger.error(\"forced shutdown\"); process.exit(1); }, 10_000);\n+}\n+\n+process.on(\"SIGTERM\", () => gracefulShutdown(\"SIGTERM\"));\n+process.on(\"SIGINT\", () => gracefulShutdown(\"SIGINT\"));"
  },
  {
    "id": "health-check-approve",
    "description": "GET /health returns status, uptime, version \u2014 should approve",
    "issueTitle": "Add health check endpoint",
    "issueNumber": 214,
    "acceptanceCriteria": "- GET /health returns JSON with status, uptime, version\n- Version from npm_package_version env var\n- Returns 200",
    "diffStats": {
      "filesChanged": 2,
      "linesChanged": 20
    },
    "branch": "feat/214-health-check",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/api/health.ts\n+++ b/src/api/health.ts\n@@ -0,0 +1,10 @@\n+import { Router } from \"express\";\n+\n+const router = Router();\n+\n+router.get(\"/health\", (_req, res) => {\n+  res.json({ status: \"ok\", uptime: process.uptime(), version: process.env.npm_package_version });\n+});\n+\n+export default router;"
  },
  {
    "id": "cors-config-approve",
    "description": "CORS with configurable allowed origins \u2014 should approve",
    "issueTitle": "Add CORS middleware with origin whitelist",
    "issueNumber": 215,
    "acceptanceCriteria": "- Allowed origins from CORS_ORIGINS env var (comma-separated, trimmed)\n- Requests without origin allowed (server-to-server)\n- Non-allowed origins rejected with false (not error)\n- Credentials enabled",
    "diffStats": {
      "filesChanged": 2,
      "linesChanged": 20
    },
    "branch": "feat/215-cors",
    "expected": {
      "approved": true
    },
    "codeDiff": "--- a/src/middleware/cors.ts\n+++ b/src/middleware/cors.ts\n@@ -0,0 +1,14 @@\n+import cors from \"cors\";\n+\n+const allowedOrigins = (process.env.CORS_ORIGINS ?? \"\")\n+  .split(\",\")\n+  .map((s) => s.trim())\n+  .filter(Boolean);\n+\n+export const corsMiddleware = cors({\n+  origin: (origin, callback) => {\n+    if (!origin || allowedOrigins.includes(origin)) {\n+      callback(null, true);\n+    } else {\n+      callback(null, false);\n+    }\n+  },\n+  credentials: true,\n+});"
  }
]